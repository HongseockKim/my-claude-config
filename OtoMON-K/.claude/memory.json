{"type":"entity","name":"OtoMON-K-Claude-Config","entityType":"Configuration","observations":["심볼릭 링크 방식으로 Claude Code 설정 공유","개인 Git: https://github.com/HongseockKim/my-claude-config.git","로컬 경로: C:/Users/user/my-claude-configs/OtoMON-K/","프로젝트 경로: C:/Users/user/IdeaProjects/OtoMON-K/"]}
{"type":"entity","name":"Symlink-Setup-Method","entityType":"Procedure","observations":["1단계: git clone https://github.com/HongseockKim/my-claude-config.git my-claude-configs (C:/Users/user/ 에서)","2단계: 관리자 PowerShell에서 setup-claude.ps1 실행","3단계: Claude Code 재시작",".claude/ 폴더는 Junction으로 연결 (cmd /c mklink /J)",".mcp.json 파일은 심볼릭링크로 연결 (cmd /c mklink)","스크립트 위치: my-claude-configs/OtoMON-K/setup-claude.ps1"]}
{"type":"entity","name":"Symlink-Files","entityType":"FileMapping","observations":[".claude/ → my-claude-configs/OtoMON-K/.claude/ (Junction)",".mcp.json → my-claude-configs/OtoMON-K/.mcp.json (Symlink)","memory.json → .claude/memory.json 에 저장됨 (MCP Memory)",".gitignore에서 .claude 제외됨 (프로젝트 Git에는 공유 안 됨)","개인 Git에는 전체 공유됨"]}
{"type":"entity","name":"MCP-Memory-Config","entityType":"Configuration","observations":["MEMORY_FILE_PATH: C:/Users/user/IdeaProjects/OtoMON-K/.claude/memory.json","심볼릭 링크로 실제 위치: my-claude-configs/OtoMON-K/.claude/memory.json","Git push/pull로 다른 PC와 메모리 동기화 가능","민감정보 주의 필요 - Private 레포 유지"]}
{"type":"entity","name":"Manual-Setup-Commands","entityType":"Procedure","observations":["관리자 PowerShell 필요","cd C:\\Users\\user\\IdeaProjects\\OtoMON-K","Remove-Item .claude -Recurse -Force (기존 폴더 삭제)","cmd /c mklink /J .claude \"C:\\Users\\user\\my-claude-configs\\OtoMON-K\\.claude\"","Remove-Item .mcp.json -Force","cmd /c mklink .mcp.json \"C:\\Users\\user\\my-claude-configs\\OtoMON-K\\.mcp.json\""]}
{"type":"entity","name":"Sync-Commands","entityType":"Procedure","observations":["Push (현재 PC): cd my-claude-configs && git add . && git commit -m \"msg\" && git push","Pull (다른 PC): cd my-claude-configs && git pull","충돌 시 memory.json 주의 - 최신 버전 선택"]}
{"type":"entity","name":"AuditLog_Setting_Pages_Complete","entityType":"Task","observations":["2026-01-27 설정 카테고리 페이지 감사로그 작업 완료","TopologyNetService: @ActivityLog 3개 추가 (ADD, DELETE, UPDATE) - resourceType=TOPOLOGY_NET","TopologyNetExtractor: 구현 완료 - extractResourceId, extractResourceName, captureBeforeData, buildDetails","SystemConfigService: @ActivityLog 추가 - resourceType=SYS_CONFIG (SYSTEM_CONFIG 아님 주의)","CodeService: updateCode()에 @ActivityLog 추가 - resourceType=CODE","DashboardTemplateService: saveTemplateWidgets()에 @ActivityLog 추가 - resourceType=TEMPLATE"]}
{"type":"entity","name":"ActivityLog_Extractor_ResourceType_Mapping","entityType":"Reference","observations":["Extractor supports() 메서드의 resourceType과 @ActivityLog의 resourceType이 일치해야 함","SystemConfigActivityLogExtractor: SYS_CONFIG (SYSTEM_CONFIG 아님)","TopologyNetExtractor: TOPOLOGY_NET","TopologySwitchExtractor: TOPOLOGY_SWITCH","CodeActivityLogExtractor: CODE","TemplateActivityLogExtractor: TEMPLATE","map(this::toJson) 타입 에러 발생 시 map(entity -> toJson(entity))로 변경"]}
{"type":"entity","name":"SessionWhite_AssetName_Feature","entityType":"Feature","observations":["화이트리스트 정책 목록에 출발지/목적지 자산명 컬럼 추가 (2026-01-27)","DB 컬럼 추가 없이 DTO에만 필드 추가하여 조회 시점에 매핑하는 방식 사용","buildIpToAssetNameMap() 메서드로 Asset 테이블에서 IP→자산명 매핑","WhiteListPolicyDto에 srcAssetName, dstAssetName 필드 추가 (라인 43-44)","toEncoded() 메서드에서 자산명 필드도 인코딩된 DTO에 포함 (라인 118, 121)","DetectionService.getAllActiveWhitelistsByZone()에서 IP→자산명 매핑 적용 (라인 207-217)","sessionWhite.js 그리드에 출발지 자산, 목적지 자산 컬럼 추가 (라인 160-164, 172-177)"]}
{"type":"entity","name":"SessionWhite_DetectedTraffic_AssetName","entityType":"Feature","observations":["탐지된 트래픽 목록에 출발지/목적지 자산명 표시 기능 (2026-01-27)","DetectionService.detectedWhiteList()에서 buildIpToAssetNameMap() 사용","linkToEncodedMap()에서 srcAssetName, dstAssetName 추가 (라인 2844-2845)","sessionWhite.js renderDetectedTraffic()에서 자산명 별도 컬럼으로 표시","sessionWhite.html 테이블 헤더에 출발지 자산, 목적지 자산 컬럼 추가 필요","sticky-top 헤더 배경색 CSS 수정 필요 (스크롤 시 겹침 문제)"]}
{"type":"entity","name":"WhitelistPolicy_Flow","entityType":"Architecture","observations":["화이트리스트 추가 흐름: JS(formData) → Controller(/sessionWhite/create) → DetectionService.createWhitelist()","createWhitelist(): 중복체크 → WhitelistPolicy INSERT → Link.isPolicy=true UPDATE","Link 테이블: 탐지된 트래픽 저장, 복합PK(srcIp, dstIp, dstPort, protocol), isPolicy 플래그로 화이트리스트 여부 관리","WhitelistPolicy 테이블: 화이트리스트 정책 저장, isShow로 소프트 삭제","삭제 시: WhitelistPolicy.isShow=false + Link.isPolicy=false → 탐지 목록에 다시 표시","탐지 목록 조회: linkRepository.findByNotIsPolicyAll() - isPolicy=false인 것만 조회"]}
{"type":"entity","name":"IP-AssetName-Mapping","entityType":"CodePattern","observations":["buildIpToAssetNameMap() 메서드 - DetectionService.java:3103-3118","Asset 테이블에서 ipAddress → systemName 매핑 생성","IP가 여러 줄일 경우 split('[\\n\\r]+')로 분리","반환: Map<String, String> (IP → 자산명)","미등록 자산일 경우 '미등록 자산' 기본값 사용","사용 예: ipToAssetNameMap.getOrDefault(ip, \"미등록 자산\")","자산명 추가 완료 페이지: timesData, timeSereiseData, analysisAndAction, session","Service 레이어에서 자산명 매핑 처리 (Controller에서 하지 않음)","ClickHouseService에 AssetRepository 주입하여 자산명 매핑","Base64 인코딩 전에 원본 IP로 자산명 조회 필수","Frontend: src_asset_name 필드로 컬럼 추가","DetectionService.getEventDetailsByTimeRangeFilteredEncoded() - 시계열 이벤트 상세","DetectionService.getAnalysisAndActionHistory() - 분석/조치 이력","DetectionService.getAllEventsOptimized() - timesData 이벤트 목록","ClickHouseService.getAllSessionWithDateRange() - 세션 데이터"]}
{"type":"entity","name":"OtoMON-K_Dashboard","entityType":"PageAnalysis","observations":["URL: /dashboard - 메인 대시보드 페이지","총 17개 위젯으로 구성","60초마다 자동 갱신 (setInterval)","GridStack CSS 기반 레이아웃 시스템","다크모드 지원 (data-bs-theme 감지)","Chart.js 2.9.x + ECharts 사용","CSRF 토큰 보호된 AJAX 요청","세션 기반 Zone 필터링 (selectedZoneCode)"]}
{"type":"entity","name":"Dashboard_Files","entityType":"FileStructure","observations":["메인 HTML: templates/pages/dashboard.html","위젯 프래그먼트: templates/fragments/dashboard/","JavaScript: static/js/dashbord.js (32.7KB)","DashboardController: controller/DashboardController.java","WidgetController: controller/WidgetController.java","DashboardTemplateService: service/DashboardTemplateService.java","DashboardWidgetService: service/DashboardWidgetService.java","DashboardZoneInitService: service/DashboardZoneInitService.java"]}
{"type":"entity","name":"Dashboard_Widgets_Power","entityType":"WidgetGroup","observations":["3호기 발전량: fragment=dashboard/sp_03/zone-status, API=/widget/zone-status/sp_03, 타입=통계카드","4호기 발전량: fragment=dashboard/sp_04/zone-status, API=/widget/zone-status/sp_04, 타입=통계카드","호기별 발전량 추이: fragment=dashboard/power-chart, API=/widget/power-generation-trend, 타입=Line+Area","호기별 터빈속도 추이: fragment=dashboard/turbine-speed-trend, API=/widget/turbine-speed-trend, 타입=Line","발전량 과다 변화 탐지: fragment=dashboard/power-fluctuation, API=/widget/power-fluctuation, 타입=Bar"]}
{"type":"entity","name":"Dashboard_Widgets_Asset","entityType":"WidgetGroup","observations":["설비유형별 자산 현황: fragment=dashboard/facility_widget, API=/widget/facility-asset, 타입=Doughnut","H/W 제조사별 자산: fragment=dashboard/manufacture_company, API=/widget/manufacture-company, 타입=Table","자산 현행화 현황: fragment=dashboard/asset_status_analysis, API=/widget/asset-status-analysis, 타입=Doughnut","자산 운전상태 현황: fragment=dashboard/asset-operation-status, API=/widget/asset-operation-status, 타입=Doughnut","신규 자산 탐지 추이: fragment=dashboard/new_asset_detection_trend, API=/widget/new-asset-detection-trend, 타입=Line"]}
{"type":"entity","name":"Dashboard_Widgets_Security","entityType":"WidgetGroup","observations":["이벤트 유형별 현황: fragment=dashboard/event_type_status, API=/widget/event-type-status, 타입=H-Bar","화이트리스트 위반 추이: fragment=dashboard/whitelist-trend, API=/widget/whitelist-trend, 타입=Bar","화이트리스트 등록 추이: fragment=dashboard/whitelist-policy-trend, API=/widget/whitelist-policy-trend, 타입=Line","태그 수집 추이: fragment=dashboard/tag-collection-trend, API=/widget/tag-collection-trend, 타입=Line","이상탐지 조치 추이: fragment=dashboard/event-action-trend, API=/widget/event-action-trend, 타입=Stacked Bar","외부 IP 통신 추이: fragment=dashboard/external-ip-communication-trend, API=/widget/external-ip-communication-trend, 타입=Mixed","사이버 위협 점검도: fragment=dashboard/cyber-threat-gauge, API=/widget/cyber-threat-score, 타입=ECharts Gauge(0-100)"]}
{"type":"entity","name":"Dashboard_DataFlow","entityType":"Architecture","observations":["흐름: DB → Repository → Service → Controller → JavaScript → HTML/Fragment","Zone 데이터: OpTag 테이블에서 조회 (zone3, tagValue JSON)","자산 데이터: Asset 테이블에서 조회","보안 이벤트: ClickHouse에서 조회 (Event1MinStats 등)","캐싱: @Cacheable(value='dashboardWidgets') 사용","JS 로딩 순서: loadAllWidgetData() → 각 위젯별 load 함수 호출"]}
{"type":"entity","name":"Dashboard_API_Endpoints","entityType":"APIList","observations":["GET /dashboard - 메인 페이지 (템플릿 위젯 로드)","GET /dashboard/widgetList - 모든 visible 위젯 목록","POST /dashboard/saveLayout - 위젯 위치/visibility 저장","POST /dashboard/toggleWidget - 위젯 visibility 토글","GET /widget/zone-status/{zone3} - 개별 zone 데이터","GET /widget/facility-asset - 설비유형별 자산","GET /widget/manufacture-company - 제조사별 자산","GET /widget/asset-status-analysis - 자산 현행화 현황","GET /widget/asset-operation-status - 자산 운전상태","GET /widget/power-generation-trend - 발전량 추이","GET /widget/turbine-speed-trend - 터빈속도 추이","GET /widget/power-fluctuation - 발전량 변화 탐지","GET /widget/new-asset-detection-trend - 신규 자산 탐지","GET /widget/whitelist-trend - 화이트리스트 위반","GET /widget/whitelist-policy-trend - 화이트리스트 등록","GET /widget/tag-collection-trend - 태그 수집 추이","GET /widget/event-action-trend - 이상탐지 조치","GET /widget/event-type-status - 이벤트 유형별","GET /widget/external-ip-communication-trend - 외부 IP 통신","GET /widget/cyber-threat-score - 사이버 위협 점수"]}
{"type":"entity","name":"WhitelistTrend_BugFix","entityType":"BugFix","observations":["위젯: 화이트리스트 위반 탐지 추이 (dashboard/whitelist-trend)","문제1: DB time_key 포맷(yyyy-MM-dd HH:mm:ss)과 Java formatter 포맷(HH:mm) 불일치로 데이터가 0으로 표시됨","해결1: WidgetService.java 1079~1087행 - DB 결과 파싱 시 포맷 변환 추가","해결1 코드: LocalDateTime.parse(rawTimeKey, DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\")).format(formatter)","문제2: X축 레이블이 1분 단위로 1441개 표시되어 불규칙하게 보임","해결2: dashbord.js 2118~2125행 - ticks.callback에서 10분/1시간 간격으로만 레이블 표시","해결2 조건: 10m 선택 시 minute % 10 === 0, 1h 선택 시 minute === 0"]}
{"type":"entity","name":"WidgetService_TimeRange_BugFix","entityType":"BugFix","observations":["대상 파일: WidgetService.java","문제: 모든 추이 위젯이 getRolling24Hours()로 24시간 데이터를 가져와서 10m/1h 버튼이 무의미함","영향 위젯: 화이트리스트 위반 탐지, 발전량 변화, 태그 수집, 이상탐지 조치, 외부 IP 통신","수정1: 1084행 - yyyy-MM-DD를 yyyy-MM-dd로 변경 (DD는 day of year)","수정2: 1065~1067행 (getWhitelistTrend) - getRolling24Hours() 대신 timeRange 기반 시간 범위","수정3: 478~480행 (getPowerFluctuationTrend) - 동일 패턴 적용","수정4: 1192~1194행 (getTagCollectionTrend) - 동일 패턴 적용","수정5: 1509~1512행 (getEventActionTrend) - 동일 패턴 적용","수정6: 1557~1559행 (getExternalIpCommunicationTrend) - 동일 패턴 적용","수정 코드 패턴: LocalDateTime endTime = LocalDateTime.now(); if (10m) startTime = endTime.minusMinutes(10); else if (1h) startTime = endTime.minusHours(1);","상태: 미완료 - 내일 계속","2026-01-28 수정 완료","endTime 정규화 로직 추가: 10m은 withMinute((minute/10)*10), 1h는 withMinute(0)","generateTimeSlots 수정: for 루프로 10개 고정 생성","프론트엔드 X축 callback 제거하여 모든 레이블 표시","2026-01-28 전체 수정 완료","수정된 백엔드 메서드: getWhitelistTrend, getPowerFluctuationTrend, getWhitelistPolicyTrend, getTagCollectionTrend, getEventActionTrend, getExternalIpCommunicationTrend, getNewAssetDetectionTrend","generateTimeSlots: for 루프로 10개 고정 생성 (10m: i*10분, 1h: i시간)","fillActionTrendTimeSlots: while 루프 → for 루프 10개 고정으로 변경","endTime 정규화: now 변수 사용하여 effectively final 문제 해결","프론트엔드 수정: 화이트리스트 위반(X축 callback 제거), 신규 자산 탐지(maxTicksLimit→autoSkip:false)","터빈속도 추이 위젯 수정 완료 (2026-01-28)","getTurbineSpeedTrend(): getRolling24Hours() 제거, timeRange 기반 시간 범위 계산 적용","10m: endTime.minusMinutes(100), 1h: endTime.minusHours(10)","빈 슬롯 10개 생성 패턴 적용: speedByTime Map으로 DB 결과 변환 후 getOrDefault(timeKey, 0)으로 매핑","for 루프 i=9~0으로 변경하여 현재 시간(정시) 포함","createEmptyTurbineSpeedResponse()도 동일 패턴 적용","dashbord.js:1661 autoSkip:true → autoSkip:false로 X축 레이블 전체 표시","2026-01-28 getWhitelistPolicyTrend 수정 완료 - for(i=9~0) 10개 슬롯 생성","2026-01-28 getPowerFluctuationTrend 수정 완료 - activeZones 조회 + zone별 10개 슬롯 생성","2026-01-28 대시보드 위젯 시간범위 버그 전체 수정 완료","2026-01-28 호기별 발전량 추이 위젯 수정 완료","getPowerGenerationTrend(): 빈 슬롯 10개 생성 후 DB 결과 매핑 패턴 적용","데이터 없을 때 0으로 표시 (다른 추이 위젯들과 동일)","endTime 정규화: 10m은 10분 단위 내림, 1h는 정시 내림","powerByTime Map으로 DB 결과 변환 후 getOrDefault(timeKey, 0)으로 매핑"]}
{"type":"entity","name":"Dashboard_TimeRange_Rule","entityType":"Standard","observations":["10m/1h 버튼 규칙 - 모든 추이 위젯에 동일 적용","10m 선택: 10분 간격 × 10개 (과거 100분)","1h 선택: 1시간 간격 × 10개 (과거 10시간)","endTime 정규화 필수: 10m은 10분 단위 내림(53분→50분), 1h는 정시 내림(09:48→09:00)","현재 시간 기준 과거 데이터만 표시 (미래 X)","X축 레이블 모두 표시 (autoSkip: false, callback 제거)","generateTimeSlots: for(i=10; i>=1; i--) endTime.minusMinutes(i*10) 또는 endTime.minusHours(i)","DB 조회 범위: startTime = endTime.minusMinutes(100) 또는 endTime.minusHours(10)","적용 위젯: 화이트리스트 위반, 발전량 변화, 태그 수집, 이상탐지 조치, 외부 IP 통신","백엔드 수정 완료 - 7개 메서드 모두 적용","프론트엔드 X축 설정: autoSkip:false, maxRotation:45로 통일 권장","람다 내 변수 사용 시 effectively final 필요 - now 변수 분리 패턴 사용","widget-header 버튼 스타일 추가: .widget-header .btn-group-sm .btn { padding: 2px 8px; font-size: 11px; line-height: 1.2; }","dashboard.css에 추가하여 10m/1h 버튼 있는 헤더 높이 통일"]}
{"type":"entity","name":"TurbineSpeedTrend_Fix","entityType":"BugFix","observations":["위젯: 호기별 터빈속도 추이 (dashboard/turbine-speed-trend)","문제1: getRolling24Hours() 사용으로 24시간 고정 조회","문제2: createEmptyTurbineSpeedResponse()에서 6분 간격(plusMinutes(i*6)) 슬롯 생성","문제3: DB 결과만 chartData에 추가하여 데이터 없으면 빈 배열","해결: timeRange 기반 시간 범위 계산 (10m: 100분, 1h: 10시간)","해결: 빈 슬롯 10개 먼저 생성 후 DB 결과 매핑 (speedByTime Map 사용)","해결: for(i=9; i>=0; i--)로 현재 정시 포함","해결: dashbord.js X축 autoSkip:false로 모든 레이블 표시","수정 파일: WidgetService.java (306-435행), dashbord.js (1661행)"]}
{"type":"entity","name":"AWS_Dev_Deployment","entityType":"Procedure","observations":["SCP 배포 명령어: scp target/OtoMON-0.0.1.jar aws-dev:~/OtoMON-K/","SSH Host: aws-dev (13.125.189.194)","User: ubuntu","IdentityFile: C:/Users/user/Downloads/otoones.pem","배포 대상: OtoMON-0.0.1.jar (약 140MB)"]}
{"type":"entity","name":"ExternalIpWidget_ButtonFix","entityType":"BugFix","observations":["위젯: 외부 IP 통신 자산 이벤트 추이 (dashboard/external-ip-communication-trend)","문제: 10m/1h 버튼이 차트 영역 안에 있어서 다른 위젯들과 UI 불일치","해결: 버튼을 프래그먼트에서 제거하고 JS에서 .panel-heading-btn에 동적 추가","수정1: external-ip-communication-trend.html - 버튼 그룹 div 제거 (라인 10-18)","수정2: dashbord.js loadExternalIpTrendWidgets() - btnContainer.find('.panel-heading-btn')에 버튼 동적 추가","수정3: dashbord.js 라인 48-49 - btn10m/btn1h ID 기반 이벤트 바인딩 제거","수정4: dashbord.js loadExternalIpTrend() - 버튼 활성화 로직을 클래스 기반으로 변경","2026-01-28 수정 완료"]}
{"type":"entity","name":"PowerGenerationTrend_EmptyData_Fix","entityType":"BugFix","observations":["위젯: 호기별 발전량 추이 (dashboard/power-chart)","문제: generation_output 데이터가 NULL일 때 차트가 완전히 비어있음","원인: DB에 generation_output이 2025-12-22 이후 수집 중단 (현재 NULL)","해결: 다른 추이 위젯들과 동일하게 빈 슬롯 10개 생성 후 0으로 채우기","수정 파일: WidgetService.java getPowerGenerationTrend() (라인 894-972)","수정 내용: endTime 정규화 → DB 조회 → powerByTime Map 변환 → 10개 슬롯 생성 → getOrDefault(timeKey, 0)","결과: 데이터 없어도 0 값으로 그래프 표시 (X축 시간대 + 0선)","전체호기 모드에서 3호기/4호기 버튼 클릭 시 정상 동작 확인","2026-01-28 수정 완료"]}
{"type":"entity","name":"DashboardTemplate_System","entityType":"Architecture","observations":["대시보드 템플릿 시스템 - GridStack.js 기반 드래그앤드롭 레이아웃 관리","관리 URL: /setting/dashboard/templates","DB 테이블: dashboard_templates (템플릿), dashboard_template_widgets (위젯 배치)","관계: 템플릿 1:N 위젯 (cascade=ALL, orphanRemoval=true)","GridStack 설정: 12열 그리드, cellHeight=68px, margin=30px"]}
{"type":"entity","name":"DashboardTemplate_DB_Structure","entityType":"Database","observations":["dashboard_templates: id, template_name(UNIQUE), description, is_default, zone_code, created_at, updated_at","dashboard_template_widgets: id, template_id(FK), fragment_name, widget_title, x_position, y_position, width, height, is_visible, sort_order, zone_code","xPosition/yPosition: GridStack 좌표 (0부터 시작)","width/height: GridStack 칸 수 (12열 기준)","isVisible: 표시 여부, sortOrder: 정렬 순서"]}
{"type":"entity","name":"DashboardTemplate_Rendering_Logic","entityType":"BusinessLogic","observations":["대시보드 렌더링 기준: 현재 zone의 기본 템플릿(isDefault=true) 조회","getDefaultTemplateWidgets(zoneCode): 기본 템플릿 없으면 첫 번째 템플릿 사용","위젯 조회: isVisible=true, sortOrder 정렬","HTML 렌더링: CSS Grid 사용 - xPosition+1, yPosition+1 (CSS Grid는 1부터 시작)","th:data-col-start, th:data-col-span, th:data-row-start, th:data-row-span으로 위치 설정","fragmentName으로 th:switch 동적 프래그먼트 렌더링"]}
{"type":"entity","name":"DashboardTemplate_Save_Logic","entityType":"BusinessLogic","observations":["위젯 저장 API: POST /setting/dashboard/api/templates/{id}/widgets","저장 로직: 기존 위젯 전체 삭제(deleteByTemplateId) → 새 위젯 배열 순회 저장","sortOrder = 배열 인덱스, isVisible = true (기본값)","GridStack에서 gridstackNode 정보 수집: x, y, w, h","data 속성에서 fragmentName, widgetTitle 추출"]}
{"type":"entity","name":"DashboardTemplate_Files","entityType":"FileStructure","observations":["Entity: DashboardTemplate.java, DashboardTemplateWidget.java","DTO: DashboardTemplateDto.java, DashboardTemplateWidgetDto.java, AvailableWidgetDto.java","Service: DashboardTemplateService.java","Controller: DashboardTemplateController.java","Repository: DashboardTemplateRepository.java, DashboardTemplateWidgetRepository.java","관리 페이지: templates/pages/setting/template.html, static/js/page.setting/templates.js","대시보드: templates/pages/dashboard.html, static/js/dashbord.js"]}
{"type":"entity","name":"DashboardTemplate_Available_Widgets","entityType":"Reference","observations":["총 17개 위젯 정의 (DashboardTemplateService.getAvailableWidgets)","3호기/4호기 발전량: dashboard/sp_03/zone-status, 3x4","호기별 발전량 추이: dashboard/power-chart, 6x4","호기별 터빈속도 추이: dashboard/turbine-speed-trend, 6x4","발전량 과다 변화량: dashboard/power-fluctuation, 6x4","설비유형별/제조사별 자산: dashboard/facility_widget, manufacture_company, 3x4","자산 현행화/운전상태: dashboard/asset_status_analysis, asset-operation-status, 3x4","신규 자산 탐지 추이: dashboard/new_asset_detection_trend, 6x4","화이트리스트 위반/등록 추이: dashboard/whitelist-trend, whitelist-policy-trend, 6x4","태그 수집/이상탐지 조치 추이: dashboard/tag-collection-trend, event-action-trend, 6x4","외부 IP 통신 자산: dashboard/external-ip-communication-trend, 6x4","사이버 위협 점검도: dashboard/cyber-threat-gauge, 3x4","이벤트 유형별 현황: dashboard/event-type-status, 3x4"]}
{"type":"entity","name":"DashboardTemplate_API_Endpoints","entityType":"APIList","observations":["GET /setting/dashboard/templates - 템플릿 관리 페이지","GET /setting/dashboard/api/templates - 모든 템플릿 조회","GET /setting/dashboard/api/templates/{id} - 특정 템플릿 상세 (위젯 포함)","POST /setting/dashboard/api/templates - 새 템플릿 생성","PUT /setting/dashboard/api/templates/{id} - 템플릿 수정","DELETE /setting/dashboard/api/templates/{id} - 템플릿 삭제 (기본 템플릿 제외)","POST /setting/dashboard/api/templates/{id}/widgets - 위젯 레이아웃 저장","GET /setting/dashboard/api/available-widgets - 사용 가능 위젯 목록 (17개)"]}
{"type":"entity","name":"DashboardTemplateWidgetPreview","entityType":"Feature","observations":["대시보드 템플릿 설정 페이지 위젯 미리보기 기능 구현 작업","요구사항: 1) GridStack에서 가짜 데이터로 실제 위젯 모양 렌더링, 2) fragment path 제거, 3) 호기 구분을 제목 옆으로 배치","계획 파일 위치: .claude/plans/elegant-sparking-bubble.md","다크모드 색상 변경 로직 발견: dashbord.js의 updateWidgetBackground(), updateFacilityChart() 함수","라이트모드 색상: ['#007bff', '#28a745', '#ffc107', '#dc3545', '#17a2b8', '#6c757d', '#6f42c1', '#fd7e14']","다크모드 색상: ['#4dabf7', '#51cf66', '#ffd43b', '#ff6b6b', '#22b8cf', '#868e96', '#9775fa', '#ff922b'] (밝은 파스텔)","다크모드 시 위젯 배경: bg-* 클래스 제거 → bg-dark 적용"]}
{"type":"entity","name":"WidgetPreviewFiles","entityType":"Implementation","observations":["신규 파일 1: static/js/page.setting/widget-mock-data.js - 위젯별 샘플 데이터 정의 (zoneStatus, facilityAsset, timeSeriesData 등)","신규 파일 2: static/js/page.setting/widget-preview-renderer.js - 위젯 타입별 미리보기 HTML 생성","신규 파일 3: static/js/page.setting/widget-preview-charts.js - Chart.js 미니 차트 초기화","수정 파일: template.html - 스크립트 임포트 추가 (integrity 포함)","수정 파일: templates.js - addWidgetToGrid, loadTemplateWidgets 함수에서 WidgetPreviewRenderer.render() 사용","수정 파일: template.css - 위젯 미리보기 스타일 추가 (.widget-preview, .zone-badge, .widget-stats-mini 등)","수정 파일: generate-sri.sh - 신규 JS 파일 3개 SRI 해시 등록","widget-mock-data.js 최종 데이터: zoneStatus, facilityAsset, manufactureCompany, assetStatusAnalysis, assetOperationStatus, eventTypeStatus, timeSeriesData, powerFluctuation, eventActionTrend, externalIpTrend, zoneMultiLine, cyberThreatGauge, eventList","widget-preview-charts.js switch 분기: doughnut, horizontalBar, bar, multiLine, area, zoneMultiLine, line(default)","widget-preview-renderer.js render() 분기: zone-status, 도넛+테이블(4종), manufacture_company, cyber-threat-gauge, power-fluctuation, event-action, external-ip, power-chart/turbine-speed, alarm-list/event-list, 기본line"]}
{"type":"entity","name":"WidgetPreviewStatus","entityType":"Status","observations":["완료: 모든 파일 생성 및 수정 완료","완료: template.html integrity 속성 추가 (widget_mock_data_js, widget_preview_renderer_js, chart_min_js, widget_preview_charts_js)","대기: generate-sri.sh 실행하여 SRI 해시 생성 필요","대기: 빌드 및 테스트 필요","2026-01-28 1단계 완료: 테이블+도넛 위젯, H/W 제조사 위젯 미리보기 구현","2026-01-28 스크롤바 숨김 CSS 추가 완료","2026-01-28 라이트모드 CSS 변수 적용 완료 (var(--bs-card-bg), var(--bs-body-color) 등)","2026-01-28 다크모드 색상 변경 작업 대기 중 - 실제 대시보드와 미리보기 색상 불일치 발견","2026-01-28 다크모드 토글 실시간 업데이트 완료","MutationObserver 패턴 사용 - data-bs-theme 속성 변경 감지","위젯 전체 다시 렌더링 방식으로 배경색 + 차트 색상 동시 업데이트","2026-01-28 전체 위젯 미리보기 구현 완료","추가된 차트 타입: bar(발전량변화), multiLine(이상탐지조치), area(외부IP), zoneMultiLine(발전량/터빈추이)","widget-mock-data.js: powerFluctuation, eventActionTrend, externalIpTrend, zoneMultiLine 데이터 추가","widget-preview-renderer.js: renderBarPreview, renderMultiLinePreview, renderAreaPreview 함수 추가","widget-preview-charts.js: getBarConfig, getMultiLineConfig, getAreaConfig, getZoneMultiLineConfig 함수 추가","getDataByFragment() 중복 조건문 버그 수정 완료 (power-chart/turbine-speed → zoneMultiLine)","2026-01-28 위젯 미리보기 수정 완료 - fragment 이름 불일치 해결","event-type-status 하이픈 버전 추가 (기존 event_type_status 언더스코어만 있었음)","widget-mock-data.js:155, widget-preview-renderer.js:190 수정","2026-01-28 화이트리스트 위반 탐지 추이 - 노란색 Area 차트로 변경 완료","whitelistViolationTrend 데이터 추가 (widget-mock-data.js:143-148)","whitelistArea 차트 타입 추가 (widget-preview-charts.js:190-214, 301-302)","whitelist-trend && !policy 조건 분리 (widget-mock-data.js:167, widget-preview-renderer.js:213-216)","2026-01-28 사이버 위협 점검도 - 반원형 게이지 + 범례로 변경 완료","renderGaugePreview 함수 전체 수정 (widget-preview-renderer.js:148-168)","게이지 CSS 전체 추가 (template.css:491-579)","범례: 정상(0-30), 주의(31-50), 경계(51-70), 심각(71-100)","conic-gradient 반원 + 바늘(needle) + 값 표시 구조","2026-01-28 게이지 색상 불일치 수정 완료 - 실제 대시보드와 동일한 색상 적용","2026-01-28 사이버 위협 점검도 미리보기 좌우 배치 수정 완료","범례(좌측) + 게이지(우측) 레이아웃으로 변경","범례 4개 항목 모두 표시되도록 간격/폰트 축소"]}
{"type":"entity","name":"OperationApiForCollector","entityType":"API","observations":["수집 서버 전용 API (인증 없이 호출) - OperationApiController.java","GET /operation/api/collection/full - OPC 서버 + 수집 태그 전체 조회 (collectionConfigs 배열 반환)","GET /operation/api/transfer/tags - OPC 서버 + 송부 태그 전체 조회 (transferConfigs 배열 반환)","응답 구조: unitCode, plantCode, opcServer{serverIp, serverPort, endpointUrl, authType}, tags[{tagType, tagPattern, description, tagUnit, nodeId, targetIp}]"]}
{"type":"entity","name":"CollectionOpTagPage","entityType":"Page","observations":["운전정보 수집 설정 페이지: /setting/collectionOpTag","JS 파일: static/js/page.setting/collectionOpTag.js","프론트엔드 API: /operation/collection/config/{plantCode}, /operation/transfer/config/{plantCode}, /operation/tags?purpose=, /operation/tag/update, /operation/tag/delete, /operation/tags/bulkUpdate"]}
{"type":"entity","name":"WidgetPreview_DarkMode_Fix","entityType":"Task","observations":["문제: 미리보기에서 다크모드 색상 변경이 적용되지 않음","원인: widget-mock-data.js, widget-preview-renderer.js, widget-preview-charts.js에 다크모드 로직 없음","해결: isDarkMode() 함수 추가, getColors() 함수로 모드별 색상 반환","수정 파일 4개: widget-mock-data.js, widget-preview-renderer.js, widget-preview-charts.js, template.css","상태: 수정 제안 완료, 적용 대기","2026-01-28 다크모드 토글 시 미리보기 업데이트 기능 완료","문제1: 다크모드 토글해도 차트 색상이 안 바뀜 - change 이벤트 리스너 추가로 해결","문제2: 새로고침 해야 변경됨 - MutationObserver로 data-bs-theme 속성 변경 감지로 해결","문제3: 차트는 바뀌지만 위젯 배경색이 그대로 - loadTemplateWidgets() 호출로 위젯 전체 다시 렌더링하여 해결","templates.js 수정사항: refreshAllPreviewCharts() 함수에서 currentTemplateId 있으면 loadTemplateWidgets(currentTemplateId) 호출","templates.js 수정사항: MutationObserver로 document.documentElement의 data-bs-theme 속성 변경 감지하여 refreshAllPreviewCharts() 호출"]}
{"type":"entity","name":"WidgetPreview_FileChanges_20260128","entityType":"FileChanges","observations":["widget-mock-data.js 수정사항:","- 143-148행: whitelistViolationTrend 데이터 추가 (노란색 Area용)","- 155행: event-type-status 하이픈 버전 조건 추가","- 167행: whitelist-trend && !policy 조건으로 whitelistViolationTrend 반환","- 168행: whitelist-policy는 기존 timeSeriesData 반환","- 183행: return 객체에 whitelistViolationTrend 추가","widget-preview-renderer.js 수정사항:","- 148-168행: renderGaugePreview() 전체 수정 - 반원형 게이지 + 범례","- 190행: event-type-status 하이픈 버전 조건 추가","- 213-216행: whitelist-trend && !policy → whitelistArea 타입","- 217-221행: whitelist-policy/tag-collection/new-asset → line 타입","widget-preview-charts.js 수정사항:","- 190-214행: getWhitelistAreaConfig() 함수 추가 (노란색 #ffc107)","- 301-302행: initChart switch에 whitelistArea case 추가","template.css 수정사항:","- 491-579행: 게이지 미리보기 CSS 전체 추가","- .gauge-preview: flex 레이아웃 (범례 + 차트)","- .gauge-legend: 범례 스타일 (4개 항목)","- .gauge-semi: conic-gradient 반원 게이지","- .gauge-needle: 바늘 (transform-origin: bottom center)","- .gauge-value: 값 표시","2026-01-28 사이버 위협 점검도 게이지 색상 수정 완료","widget-preview-renderer.js:155-158 범례 색상 수정: #51cf66→#52c41a, #ffd43b→#fadb14, #ff922b→#fa8c16, #ff6b6b→#f5222d","template.css:544-551 conic-gradient 색상 수정: 동일하게 실제 대시보드 색상으로 변경","다크모드 파스텔톤에서 실제 대시보드 색상(dashboard.css .legend-normal 등)으로 통일","2026-01-28 사이버 위협 점검도 미리보기 최종 수정 완료","widget-preview-renderer.js: isDark/bgClass 제거, bg-dark 클래스 없이 gauge-preview만 사용","widget-preview-renderer.js: legend-color 클래스 유지 (legend-circle 아님)","template.css .gauge-preview: flex-direction:row 추가, gap:4px로 변경","template.css .gauge-legend: gap:1px, font-size:7px, flex:0 0 auto, min-width:55px 추가","파란색 배경(#348fe2) 추가는 취소 - 위젯 카드 자체 배경색 사용"]}
{"type":"entity","name":"WidgetPreview_PendingTasks","entityType":"PendingTask","observations":["대기 작업: generate-sri.sh 실행하여 SRI 해시 생성 필요","대기 작업: 빌드 및 브라우저 테스트 필요","대기 작업: 다크모드/라이트모드 전환 시 게이지 색상 확인 필요","주의사항: template.css에 .gauge-preview 관련 스타일 중복 있을 수 있음 (308-325행 vs 491-579행)","테스트 URL: /setting/dashboard/templates","완료: 다크모드/라이트모드 전환 시 게이지 색상 확인 - 실제 대시보드 색상으로 통일됨"]}
{"type":"relation","from":"OtoMON-K-Claude-Config","to":"Symlink-Files","relationType":"contains"}
{"type":"relation","from":"OtoMON-K-Claude-Config","to":"MCP-Memory-Config","relationType":"includes"}
{"type":"relation","from":"Symlink-Setup-Method","to":"OtoMON-K-Claude-Config","relationType":"configures"}
{"type":"relation","from":"Manual-Setup-Commands","to":"Symlink-Files","relationType":"creates"}
{"type":"relation","from":"Sync-Commands","to":"MCP-Memory-Config","relationType":"synchronizes"}
{"type":"relation","from":"SessionWhite_AssetName_Feature","to":"WhitelistPolicy_Flow","relationType":"extends"}
{"type":"relation","from":"SessionWhite_DetectedTraffic_AssetName","to":"WhitelistPolicy_Flow","relationType":"extends"}
{"type":"relation","from":"SessionWhite_AssetName_Feature","to":"SessionWhite_DetectedTraffic_AssetName","relationType":"related_to"}
{"type":"relation","from":"OtoMON-K_Dashboard","to":"Dashboard_Files","relationType":"has_files"}
{"type":"relation","from":"OtoMON-K_Dashboard","to":"Dashboard_Widgets_Power","relationType":"contains_widgets"}
{"type":"relation","from":"OtoMON-K_Dashboard","to":"Dashboard_Widgets_Asset","relationType":"contains_widgets"}
{"type":"relation","from":"OtoMON-K_Dashboard","to":"Dashboard_Widgets_Security","relationType":"contains_widgets"}
{"type":"relation","from":"OtoMON-K_Dashboard","to":"Dashboard_DataFlow","relationType":"follows_architecture"}
{"type":"relation","from":"OtoMON-K_Dashboard","to":"Dashboard_API_Endpoints","relationType":"exposes_apis"}
{"type":"relation","from":"WhitelistTrend_BugFix","to":"Dashboard_Widgets_Security","relationType":"fixes_widget_in"}
{"type":"relation","from":"Dashboard_TimeRange_Rule","to":"OtoMON-K_Dashboard","relationType":"applies_to"}
{"type":"relation","from":"Dashboard_TimeRange_Rule","to":"Dashboard_Widgets_Security","relationType":"governs"}
{"type":"relation","from":"TurbineSpeedTrend_Fix","to":"Dashboard_Widgets_Power","relationType":"fixes_widget_in"}
{"type":"relation","from":"TurbineSpeedTrend_Fix","to":"Dashboard_TimeRange_Rule","relationType":"follows_standard"}
{"type":"relation","from":"ExternalIpWidget_ButtonFix","to":"Dashboard_Widgets_Security","relationType":"fixes_widget_in"}
{"type":"relation","from":"PowerGenerationTrend_EmptyData_Fix","to":"Dashboard_Widgets_Power","relationType":"fixes_widget_in"}
{"type":"relation","from":"PowerGenerationTrend_EmptyData_Fix","to":"Dashboard_TimeRange_Rule","relationType":"follows_standard"}
{"type":"relation","from":"DashboardTemplate_System","to":"OtoMON-K_Dashboard","relationType":"configures"}
{"type":"relation","from":"DashboardTemplate_DB_Structure","to":"DashboardTemplate_System","relationType":"part_of"}
{"type":"relation","from":"DashboardTemplate_Rendering_Logic","to":"DashboardTemplate_System","relationType":"part_of"}
{"type":"relation","from":"DashboardTemplate_Save_Logic","to":"DashboardTemplate_System","relationType":"part_of"}
{"type":"relation","from":"DashboardTemplate_Files","to":"DashboardTemplate_System","relationType":"implements"}
{"type":"relation","from":"DashboardTemplate_Available_Widgets","to":"DashboardTemplate_System","relationType":"defines"}
{"type":"relation","from":"DashboardTemplate_API_Endpoints","to":"DashboardTemplate_System","relationType":"exposes"}
{"type":"relation","from":"DashboardTemplateWidgetPreview","to":"WidgetPreviewFiles","relationType":"implemented_by"}
{"type":"relation","from":"DashboardTemplateWidgetPreview","to":"WidgetPreviewStatus","relationType":"has_status"}
{"type":"relation","from":"CollectionOpTagPage","to":"OperationApiForCollector","relationType":"provides_data_to"}
{"type":"relation","from":"WidgetPreviewFiles","to":"CollectionOpTagPage","relationType":"references_api_from"}
{"type":"relation","from":"WidgetPreview_DarkMode_Fix","to":"DashboardTemplateWidgetPreview","relationType":"fixes"}
{"type":"relation","from":"WidgetPreview_DarkMode_Fix","to":"WidgetPreviewFiles","relationType":"modifies"}
{"type":"relation","from":"WidgetPreview_FileChanges_20260128","to":"DashboardTemplateWidgetPreview","relationType":"implements"}
{"type":"relation","from":"WidgetPreview_PendingTasks","to":"DashboardTemplateWidgetPreview","relationType":"remains_for"}