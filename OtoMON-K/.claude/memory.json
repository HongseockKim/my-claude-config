{"type":"entity","name":"OtoMON-K-Claude-Config","entityType":"Configuration","observations":["심볼릭 링크 방식으로 Claude Code 설정 공유","개인 Git: https://github.com/HongseockKim/my-claude-config.git","로컬 경로: C:/Users/user/my-claude-configs/OtoMON-K/","프로젝트 경로: C:/Users/user/IdeaProjects/OtoMON-K/"]}
{"type":"entity","name":"Symlink-Setup-Method","entityType":"Procedure","observations":["1단계: git clone https://github.com/HongseockKim/my-claude-config.git my-claude-configs (C:/Users/user/ 에서)","2단계: 관리자 PowerShell에서 setup-claude.ps1 실행","3단계: Claude Code 재시작",".claude/ 폴더는 Junction으로 연결 (cmd /c mklink /J)",".mcp.json 파일은 심볼릭링크로 연결 (cmd /c mklink)","스크립트 위치: my-claude-configs/OtoMON-K/setup-claude.ps1"]}
{"type":"entity","name":"Symlink-Files","entityType":"FileMapping","observations":[".claude/ → my-claude-configs/OtoMON-K/.claude/ (Junction)",".mcp.json → my-claude-configs/OtoMON-K/.mcp.json (Symlink)","memory.json → .claude/memory.json 에 저장됨 (MCP Memory)",".gitignore에서 .claude 제외됨 (프로젝트 Git에는 공유 안 됨)","개인 Git에는 전체 공유됨"]}
{"type":"entity","name":"MCP-Memory-Config","entityType":"Configuration","observations":["MEMORY_FILE_PATH: C:/Users/user/IdeaProjects/OtoMON-K/.claude/memory.json","심볼릭 링크로 실제 위치: my-claude-configs/OtoMON-K/.claude/memory.json","Git push/pull로 다른 PC와 메모리 동기화 가능","민감정보 주의 필요 - Private 레포 유지"]}
{"type":"entity","name":"Manual-Setup-Commands","entityType":"Procedure","observations":["관리자 PowerShell 필요","cd C:\\Users\\user\\IdeaProjects\\OtoMON-K","Remove-Item .claude -Recurse -Force (기존 폴더 삭제)","cmd /c mklink /J .claude \"C:\\Users\\user\\my-claude-configs\\OtoMON-K\\.claude\"","Remove-Item .mcp.json -Force","cmd /c mklink .mcp.json \"C:\\Users\\user\\my-claude-configs\\OtoMON-K\\.mcp.json\""]}
{"type":"entity","name":"Sync-Commands","entityType":"Procedure","observations":["Push (현재 PC): cd my-claude-configs && git add . && git commit -m \"msg\" && git push","Pull (다른 PC): cd my-claude-configs && git pull","충돌 시 memory.json 주의 - 최신 버전 선택"]}
{"type":"entity","name":"AuditLog_Setting_Pages_Complete","entityType":"Task","observations":["2026-01-27 설정 카테고리 페이지 감사로그 작업 완료","TopologyNetService: @ActivityLog 3개 추가 (ADD, DELETE, UPDATE) - resourceType=TOPOLOGY_NET","TopologyNetExtractor: 구현 완료 - extractResourceId, extractResourceName, captureBeforeData, buildDetails","SystemConfigService: @ActivityLog 추가 - resourceType=SYS_CONFIG (SYSTEM_CONFIG 아님 주의)","CodeService: updateCode()에 @ActivityLog 추가 - resourceType=CODE","DashboardTemplateService: saveTemplateWidgets()에 @ActivityLog 추가 - resourceType=TEMPLATE"]}
{"type":"entity","name":"ActivityLog_Extractor_ResourceType_Mapping","entityType":"Reference","observations":["Extractor supports() 메서드의 resourceType과 @ActivityLog의 resourceType이 일치해야 함","SystemConfigActivityLogExtractor: SYS_CONFIG (SYSTEM_CONFIG 아님)","TopologyNetExtractor: TOPOLOGY_NET","TopologySwitchExtractor: TOPOLOGY_SWITCH","CodeActivityLogExtractor: CODE","TemplateActivityLogExtractor: TEMPLATE","map(this::toJson) 타입 에러 발생 시 map(entity -> toJson(entity))로 변경"]}
{"type":"entity","name":"SessionWhite_AssetName_Feature","entityType":"Feature","observations":["화이트리스트 정책 목록에 출발지/목적지 자산명 컬럼 추가 (2026-01-27)","DB 컬럼 추가 없이 DTO에만 필드 추가하여 조회 시점에 매핑하는 방식 사용","buildIpToAssetNameMap() 메서드로 Asset 테이블에서 IP→자산명 매핑","WhiteListPolicyDto에 srcAssetName, dstAssetName 필드 추가 (라인 43-44)","toEncoded() 메서드에서 자산명 필드도 인코딩된 DTO에 포함 (라인 118, 121)","DetectionService.getAllActiveWhitelistsByZone()에서 IP→자산명 매핑 적용 (라인 207-217)","sessionWhite.js 그리드에 출발지 자산, 목적지 자산 컬럼 추가 (라인 160-164, 172-177)"]}
{"type":"entity","name":"SessionWhite_DetectedTraffic_AssetName","entityType":"Feature","observations":["탐지된 트래픽 목록에 출발지/목적지 자산명 표시 기능 (2026-01-27)","DetectionService.detectedWhiteList()에서 buildIpToAssetNameMap() 사용","linkToEncodedMap()에서 srcAssetName, dstAssetName 추가 (라인 2844-2845)","sessionWhite.js renderDetectedTraffic()에서 자산명 별도 컬럼으로 표시","sessionWhite.html 테이블 헤더에 출발지 자산, 목적지 자산 컬럼 추가 필요","sticky-top 헤더 배경색 CSS 수정 필요 (스크롤 시 겹침 문제)"]}
{"type":"entity","name":"WhitelistPolicy_Flow","entityType":"Architecture","observations":["화이트리스트 추가 흐름: JS(formData) → Controller(/sessionWhite/create) → DetectionService.createWhitelist()","createWhitelist(): 중복체크 → WhitelistPolicy INSERT → Link.isPolicy=true UPDATE","Link 테이블: 탐지된 트래픽 저장, 복합PK(srcIp, dstIp, dstPort, protocol), isPolicy 플래그로 화이트리스트 여부 관리","WhitelistPolicy 테이블: 화이트리스트 정책 저장, isShow로 소프트 삭제","삭제 시: WhitelistPolicy.isShow=false + Link.isPolicy=false → 탐지 목록에 다시 표시","탐지 목록 조회: linkRepository.findByNotIsPolicyAll() - isPolicy=false인 것만 조회"]}
{"type":"entity","name":"IP-AssetName-Mapping","entityType":"CodePattern","observations":["buildIpToAssetNameMap() 메서드 - DetectionService.java:3103-3118","Asset 테이블에서 ipAddress → systemName 매핑 생성","IP가 여러 줄일 경우 split('[\\n\\r]+')로 분리","반환: Map<String, String> (IP → 자산명)","미등록 자산일 경우 '미등록 자산' 기본값 사용","사용 예: ipToAssetNameMap.getOrDefault(ip, \"미등록 자산\")","자산명 추가 완료 페이지: timesData, timeSereiseData, analysisAndAction, session","Service 레이어에서 자산명 매핑 처리 (Controller에서 하지 않음)","ClickHouseService에 AssetRepository 주입하여 자산명 매핑","Base64 인코딩 전에 원본 IP로 자산명 조회 필수","Frontend: src_asset_name 필드로 컬럼 추가","DetectionService.getEventDetailsByTimeRangeFilteredEncoded() - 시계열 이벤트 상세","DetectionService.getAnalysisAndActionHistory() - 분석/조치 이력","DetectionService.getAllEventsOptimized() - timesData 이벤트 목록","ClickHouseService.getAllSessionWithDateRange() - 세션 데이터"]}
{"type":"entity","name":"OtoMON-K_Dashboard","entityType":"PageAnalysis","observations":["URL: /dashboard - 메인 대시보드 페이지","총 17개 위젯으로 구성","60초마다 자동 갱신 (setInterval)","GridStack CSS 기반 레이아웃 시스템","다크모드 지원 (data-bs-theme 감지)","Chart.js 2.9.x + ECharts 사용","CSRF 토큰 보호된 AJAX 요청","세션 기반 Zone 필터링 (selectedZoneCode)"]}
{"type":"entity","name":"Dashboard_Files","entityType":"FileStructure","observations":["메인 HTML: templates/pages/dashboard.html","위젯 프래그먼트: templates/fragments/dashboard/","JavaScript: static/js/dashbord.js (32.7KB)","DashboardController: controller/DashboardController.java","WidgetController: controller/WidgetController.java","DashboardTemplateService: service/DashboardTemplateService.java","DashboardWidgetService: service/DashboardWidgetService.java","DashboardZoneInitService: service/DashboardZoneInitService.java"]}
{"type":"entity","name":"Dashboard_Widgets_Power","entityType":"WidgetGroup","observations":["3호기 발전량: fragment=dashboard/sp_03/zone-status, API=/widget/zone-status/sp_03, 타입=통계카드","4호기 발전량: fragment=dashboard/sp_04/zone-status, API=/widget/zone-status/sp_04, 타입=통계카드","호기별 발전량 추이: fragment=dashboard/power-chart, API=/widget/power-generation-trend, 타입=Line+Area","호기별 터빈속도 추이: fragment=dashboard/turbine-speed-trend, API=/widget/turbine-speed-trend, 타입=Line","발전량 과다 변화 탐지: fragment=dashboard/power-fluctuation, API=/widget/power-fluctuation, 타입=Bar"]}
{"type":"entity","name":"Dashboard_Widgets_Asset","entityType":"WidgetGroup","observations":["설비유형별 자산 현황: fragment=dashboard/facility_widget, API=/widget/facility-asset, 타입=Doughnut","H/W 제조사별 자산: fragment=dashboard/manufacture_company, API=/widget/manufacture-company, 타입=Table","자산 현행화 현황: fragment=dashboard/asset_status_analysis, API=/widget/asset-status-analysis, 타입=Doughnut","자산 운전상태 현황: fragment=dashboard/asset-operation-status, API=/widget/asset-operation-status, 타입=Doughnut","신규 자산 탐지 추이: fragment=dashboard/new_asset_detection_trend, API=/widget/new-asset-detection-trend, 타입=Line"]}
{"type":"entity","name":"Dashboard_Widgets_Security","entityType":"WidgetGroup","observations":["이벤트 유형별 현황: fragment=dashboard/event_type_status, API=/widget/event-type-status, 타입=H-Bar","화이트리스트 위반 추이: fragment=dashboard/whitelist-trend, API=/widget/whitelist-trend, 타입=Bar","화이트리스트 등록 추이: fragment=dashboard/whitelist-policy-trend, API=/widget/whitelist-policy-trend, 타입=Line","태그 수집 추이: fragment=dashboard/tag-collection-trend, API=/widget/tag-collection-trend, 타입=Line","이상탐지 조치 추이: fragment=dashboard/event-action-trend, API=/widget/event-action-trend, 타입=Stacked Bar","외부 IP 통신 추이: fragment=dashboard/external-ip-communication-trend, API=/widget/external-ip-communication-trend, 타입=Mixed","사이버 위협 점검도: fragment=dashboard/cyber-threat-gauge, API=/widget/cyber-threat-score, 타입=ECharts Gauge(0-100)"]}
{"type":"entity","name":"Dashboard_DataFlow","entityType":"Architecture","observations":["흐름: DB → Repository → Service → Controller → JavaScript → HTML/Fragment","Zone 데이터: OpTag 테이블에서 조회 (zone3, tagValue JSON)","자산 데이터: Asset 테이블에서 조회","보안 이벤트: ClickHouse에서 조회 (Event1MinStats 등)","캐싱: @Cacheable(value='dashboardWidgets') 사용","JS 로딩 순서: loadAllWidgetData() → 각 위젯별 load 함수 호출"]}
{"type":"entity","name":"Dashboard_API_Endpoints","entityType":"APIList","observations":["GET /dashboard - 메인 페이지 (템플릿 위젯 로드)","GET /dashboard/widgetList - 모든 visible 위젯 목록","POST /dashboard/saveLayout - 위젯 위치/visibility 저장","POST /dashboard/toggleWidget - 위젯 visibility 토글","GET /widget/zone-status/{zone3} - 개별 zone 데이터","GET /widget/facility-asset - 설비유형별 자산","GET /widget/manufacture-company - 제조사별 자산","GET /widget/asset-status-analysis - 자산 현행화 현황","GET /widget/asset-operation-status - 자산 운전상태","GET /widget/power-generation-trend - 발전량 추이","GET /widget/turbine-speed-trend - 터빈속도 추이","GET /widget/power-fluctuation - 발전량 변화 탐지","GET /widget/new-asset-detection-trend - 신규 자산 탐지","GET /widget/whitelist-trend - 화이트리스트 위반","GET /widget/whitelist-policy-trend - 화이트리스트 등록","GET /widget/tag-collection-trend - 태그 수집 추이","GET /widget/event-action-trend - 이상탐지 조치","GET /widget/event-type-status - 이벤트 유형별","GET /widget/external-ip-communication-trend - 외부 IP 통신","GET /widget/cyber-threat-score - 사이버 위협 점수"]}
{"type":"entity","name":"WhitelistTrend_BugFix","entityType":"BugFix","observations":["위젯: 화이트리스트 위반 탐지 추이 (dashboard/whitelist-trend)","문제1: DB time_key 포맷(yyyy-MM-dd HH:mm:ss)과 Java formatter 포맷(HH:mm) 불일치로 데이터가 0으로 표시됨","해결1: WidgetService.java 1079~1087행 - DB 결과 파싱 시 포맷 변환 추가","해결1 코드: LocalDateTime.parse(rawTimeKey, DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\")).format(formatter)","문제2: X축 레이블이 1분 단위로 1441개 표시되어 불규칙하게 보임","해결2: dashbord.js 2118~2125행 - ticks.callback에서 10분/1시간 간격으로만 레이블 표시","해결2 조건: 10m 선택 시 minute % 10 === 0, 1h 선택 시 minute === 0"]}
{"type":"entity","name":"WidgetService_TimeRange_BugFix","entityType":"BugFix","observations":["대상 파일: WidgetService.java","문제: 모든 추이 위젯이 getRolling24Hours()로 24시간 데이터를 가져와서 10m/1h 버튼이 무의미함","영향 위젯: 화이트리스트 위반 탐지, 발전량 변화, 태그 수집, 이상탐지 조치, 외부 IP 통신","수정1: 1084행 - yyyy-MM-DD를 yyyy-MM-dd로 변경 (DD는 day of year)","수정2: 1065~1067행 (getWhitelistTrend) - getRolling24Hours() 대신 timeRange 기반 시간 범위","수정3: 478~480행 (getPowerFluctuationTrend) - 동일 패턴 적용","수정4: 1192~1194행 (getTagCollectionTrend) - 동일 패턴 적용","수정5: 1509~1512행 (getEventActionTrend) - 동일 패턴 적용","수정6: 1557~1559행 (getExternalIpCommunicationTrend) - 동일 패턴 적용","수정 코드 패턴: LocalDateTime endTime = LocalDateTime.now(); if (10m) startTime = endTime.minusMinutes(10); else if (1h) startTime = endTime.minusHours(1);","상태: 미완료 - 내일 계속"]}
{"type":"relation","from":"OtoMON-K-Claude-Config","to":"Symlink-Files","relationType":"contains"}
{"type":"relation","from":"OtoMON-K-Claude-Config","to":"MCP-Memory-Config","relationType":"includes"}
{"type":"relation","from":"Symlink-Setup-Method","to":"OtoMON-K-Claude-Config","relationType":"configures"}
{"type":"relation","from":"Manual-Setup-Commands","to":"Symlink-Files","relationType":"creates"}
{"type":"relation","from":"Sync-Commands","to":"MCP-Memory-Config","relationType":"synchronizes"}
{"type":"relation","from":"SessionWhite_AssetName_Feature","to":"WhitelistPolicy_Flow","relationType":"extends"}
{"type":"relation","from":"SessionWhite_DetectedTraffic_AssetName","to":"WhitelistPolicy_Flow","relationType":"extends"}
{"type":"relation","from":"SessionWhite_AssetName_Feature","to":"SessionWhite_DetectedTraffic_AssetName","relationType":"related_to"}
{"type":"relation","from":"OtoMON-K_Dashboard","to":"Dashboard_Files","relationType":"has_files"}
{"type":"relation","from":"OtoMON-K_Dashboard","to":"Dashboard_Widgets_Power","relationType":"contains_widgets"}
{"type":"relation","from":"OtoMON-K_Dashboard","to":"Dashboard_Widgets_Asset","relationType":"contains_widgets"}
{"type":"relation","from":"OtoMON-K_Dashboard","to":"Dashboard_Widgets_Security","relationType":"contains_widgets"}
{"type":"relation","from":"OtoMON-K_Dashboard","to":"Dashboard_DataFlow","relationType":"follows_architecture"}
{"type":"relation","from":"OtoMON-K_Dashboard","to":"Dashboard_API_Endpoints","relationType":"exposes_apis"}
{"type":"relation","from":"WhitelistTrend_BugFix","to":"Dashboard_Widgets_Security","relationType":"fixes_widget_in"}